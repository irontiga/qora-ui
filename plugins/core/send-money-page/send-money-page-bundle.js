!function(){"use strict";function c(e,t,n,r,a,o,s){try{var i=e[o](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}var u={1:"Valid OK",2:"Invalid address",3:"Negative amount",4:"Nagative fee",5:"No balance",6:"Invalid reference",7:"Invalid time length",8:"Invalid value length",9:"Name already registered",10:"Name does not exist",11:"Invalid name owner",12:"Name already for sale",13:"Name not for sale",14:"Name buyer already owner",15:"Invalid amount",16:"Invalid seller",17:"Name not lowercase",18:"Invalid description length",19:"Invalid options length",20:"Invalid option length",21:"Duplicate option",22:"Poll already created",23:"Poll already has votes",24:"Poll does not exist",25:"Option does not exist",26:"Already voted for that option",27:"Invalid data length",28:"Invalid quantity",29:"Asset does not exist",30:"Invalid return",31:"Have equals want",32:"Order does not exist",33:"Invalid order creator",34:"Invalid payments length",35:"Negative price",36:"Invalid creation bytes",37:"Invalid tags length",38:"Invalid type length",40:"Fee less required",41:"Invalid raw data",42:"Delegation already exists",43:"Supernode invalid",44:"Super node already exists",45:"Spending disallowed",1e4:"AT_ERROR",1e3:"Not yet released.."},e=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),d(this,o(t).call(this))}var i,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,Polymer.Element),a(t,null,[{key:"is",get:function(){return"send-money-page"}},{key:"properties",get:function(){return{addresses:{type:Array,value:[]},amount:{type:Number},errorMessage:{type:String,value:""},sendMoneyLoading:{type:Boolean,value:!1},data:{type:Object,value:{}},addressesInfo:{type:Object,value:{}},selectedAddress:{type:Object,value:{}},selectedAddressInfo:{type:Object,value:{},computed:"_getSelectedAddressInfo(addressesInfo, selectedAddress)"},addressesUnconfirmedTransactions:{type:Object,value:{}},addressInfoStreams:{type:Object,value:{}},unconfirmedTransactionStreams:{type:Object,value:{}},maxWidth:{type:String,value:"600"}}}},{key:"observers",get:function(){return["_usdKeyUp(usdAmount)","_kmxKeyUp(amount)"]}}]),a(t,[{key:"_floor",value:function(e){return Math.floor(e)}},{key:"_checkAmount",value:function(){this.validAmount=this.amount>=this.selectedAddressInfo.nativeBalance.total[0]}},{key:"textColor",value:function(e){return"light"==e?"rgba(255,255,255,0.7)":"rgba(0,0,0,0.87)"}},{key:"_sendMoney",value:(i=regeneratorRuntime.mark(function e(t){var n,r,a,o,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.amount*Math.pow(10,8),r=this.recipient,this.sendMoneyLoading=!0,console.log(this.selectedAddress),e.next=6,this.parentWimp.request("qoraApiCall",{data:{type:"api",url:"addresses/lastreference/".concat(this.selectedAddress.address,"/unconfirmed")}});case 6:return a=(a=e.sent).data,e.next=10,this.parentWimp.request("qoraApiCall",{data:{type:"api",url:"names/".concat(r)}}).catch(function(e){return JSON.stringify({})});case 10:o=e.sent,console.log(o),o.success&&(o=JSON.parse(o.data),r=o.value),this.parentWimp.request("createTransaction",{data:{type:2,nonce:this.selectedAddress.nonce,params:{recipient:r,amount:n,lastReference:a}}}).then(function(e){var t=JSON.parse(e.data);if(console.log("Yay: ",e),!t.reference)throw"Error! ".concat(u[t],". Error code ").concat(t);s.errorMessage="",s.recipient="",s.amount="",s.successMessage="Success! "+e.data}).catch(function(e){console.log(e),s.errorMessage=e});case 14:case"end":return e.stop()}},e,this)}),n=function(){var e=this,s=arguments;return new Promise(function(t,n){var r=i.apply(e,s);function a(e){c(r,t,n,a,o,"next",e)}function o(e){c(r,t,n,a,o,"throw",e)}a(void 0)})},function(e){return n.apply(this,arguments)})},{key:"_usdKeyUp",value:function(){this.amount=this.usdAmount/this.BTCUSD}},{key:"_kmxKeyUp",value:function(){this.usdAmount=this.amount*this.BTCUSD}},{key:"updateBTCPrice",value:function(){var t=this;this._getBTCPrice().then(function(e){console.log(e),t.BTCUSD=e.USD.last},function(e){})}},{key:"_getBTCPrice",value:function(){return new Promise(function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&(console.log("RESPONSESESESSESESS",n),200!=this.status&&t(),e(JSON.parse(n.responseText)))},n.open("GET","https://blockchain.info/ticker",!0),n.send()})}},{key:"_getSelectedAddressInfo",value:function(e,t){return this.addressesInfo[t.address]}},{key:"kmxToUSD",value:function(e,t){return e*t}},{key:"ready",value:function(){var r=this;l(o(t.prototype),"ready",this).call(this),this.coreWimp=new Wimp("core",window.parent),this.parentWimp=new Wimp(window.parent),this.parentWimp.ready(function(){r.parentWimp.listen("Selected address",function(e){console.log(e),r.selectedAddress={};var n=(r.selectedAddress=e).address;r.coreWimp.ready(function(){r.addressInfoStreams[n]||(r.addressInfoStreams[n]=r.coreWimp.listen("address/".concat(n),function(e){console.log("Send money page received",e),e.nativeBalance=e.nativeBalance||{total:{}},e.nativeBalance.total[0]=e.nativeBalance.total[0]||0,r.set("addressesInfo.".concat(n),e);var t=r.addressesInfo;r.addressesInfo={},r.addressesInfo=t})),r.unconfirmedTransactionStreams[n]||(r.unconfirmedTransactionStreams[n]=r.coreWimp.listen("unconfirmedOfAddress/".concat(n),function(e){r.addressesUnconfirmedTransactions[n]=e}))})})}),this.updateBTCPrice(),setInterval(function(){return r.updateBTCPrice()},1e4),Wimp.init()}}]),t}();window.customElements.define(e.is,e)}();
