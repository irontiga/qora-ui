!function(e){var s={};function t(r){if(s[r])return s[r].exports;var a=s[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=s,t.d=function(e,s,r){t.o(e,s)||Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},t.p="",t(t.s=171)}({171:function(e,s,t){"use strict";t.r(s);const r={};[].push((e,s)=>e.recipient===s||e.sender===s),[].push((e,s)=>e.generator===s);Wimp.init();const a=new Wimp(window.parent);a.request("registerUrl",{data:{url:"wallet",page:"core/wallet/index.html",title:"Wallet",icon:"credit-card",menus:[],parent:!1}},e=>{}),a.request("registerUrl",{data:{url:"send-money",page:"core/send-money-page/index.html",title:"Send money",icon:"send",menus:[],parent:!1}},e=>{}),new class{constructor(e){this._parentWimp=e,this._blockCheck=new class{constructor(e){this._parentWimp=e,this._eachNewBlockFunctions=[],this._lastBlock={height:-1},this._blockStream=e.createStream("New block",(e,s)=>{s(this._lastBlock)})}check(){const e=this._check();e.then(()=>{setTimeout(()=>this.check(),3e3)}),e.catch(()=>{setTimeout(()=>this.check(),3e3)})}async _check(){console.log("checking block");let e=setTimeout(()=>{throw new Error("Block check timed out")},3e3);const s=await this._parentWimp.request("qoraApiCall",{data:{type:"api",url:"blocks/last"}});clearTimeout(e);const t=JSON.parse(s.data);t.height>this._lastBlock.height&&(console.log("NNEEEWWW BLLOOCCCKKK"),this._lastBlock=t,this._blockStream.emit(this._lastBlock),this._eachNewBlockFunctions.forEach(e=>e(this._lastBlock)))}addNewBlockFunction(e){this._eachNewBlockFunctions.push(e)}}(e),this._addressWatcher=new class{constructor(e,s){s=s||[],this._parentWimp=e,this.reset(),s.forEach(e=>this.addAddress(e))}reset(){this._addresses={},this._addressStreams={}}addAddress(e){const s=e.address;this._addresses[s]=e,this._addressStreams[s]=this._parentWimp.createStream(`address/${s}`,(e,t)=>{t(this._addresses[s])}),this.updateAddress(s)}testBlock(e){const s=[];e.transactions.forEach(e=>{console.log(this);for(const e of Object.keys(this._addresses))e in s||s.push(e)}),s.forEach(e=>this.updateAddress(e))}async updateAddress(e){console.log("UPPPDDAAATTTINGGG AADDDRRR",e);const s=await this._parentWimp.request("qoraApiCall",{data:{type:"explorer",data:{addr:e,txOnPage:10}}});console.log("response: ",s);const t=s.success?s.data:r;t.transactions=[];for(let e=t.start;e>=t.end;e--)t.transactions.push(t[e]),delete t[e];this._addresses[e]&&(this._addresses[e]=t,this._addressStreams[e].emit(t))}}(e),this._unconfirmedTransactionWatcher=new class{constructor(e){this._parentWimp=e,this._unconfirmedTransactionStreams={},this.reset()}reset(){this._addresses={},this._addressesUnconfirmedTransactions={}}addAddress(e){const s=e.address;this._addresses[s]=e,this._addressesUnconfirmedTransactions[s]=[],this._unconfirmedTransactionStreams[s]||(this._unconfirmedTransactionStreams[s]=this._parentWimp.createStream(`unconfirmedOfAddress/${s}`,(e,t)=>{t(this._addressesUnconfirmedTransactions[s])}))}check(){this._addressTransactionCheck().then(()=>setTimeout(()=>this.check(),5e3)).catch(()=>setTimeout(()=>this.check(),5e3))}async _addressTransactionCheck(){return Promise.all(Object.keys(this._addresses).map(e=>this._parentWimp.request("qoraApiCall",{data:{type:"api",url:`transactions/unconfirmedof/${e}`}}).then(s=>{s=JSON.parse(s.data),this._unconfirmedTransactionStreams[e].emit(s)})))}}(e),e.on("login",async()=>{const s=await e.request("getQoraAddresses");this.updateAddresses(s.data)}),this._blockCheck.addNewBlockFunction(this._addressWatcher.testBlock.bind(this._addressWatcher)),this._blockCheck.check(),this._unconfirmedTransactionWatcher.check()}updateAddresses(e){this._addressWatcher.reset(),e.forEach(e=>this._addressWatcher.addAddress(e)),this._unconfirmedTransactionWatcher.reset(),e.forEach(e=>this._unconfirmedTransactionWatcher.addAddress(e))}}(a)}});