<link rel="import" href="/client/bower_components/polymer/polymer.html">

<!-- POLYMER ELEMENTS -->
<link rel="import" href="/client/bower_components/paper-material/paper-material.html">
<link rel="import" href="/client/bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="/client/bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="/client/bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/client/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="/client/bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="/client/bower_components/paper-item/paper-item.html">
<link rel="import" href="/client/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/client/bower_components/iron-icons/av-icons.html">
<link rel="import" href="/client/bower_components/iron-icons/communication-icons.html">
<link rel="import" href="/client/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/client/bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="/client/bower_components/paper-menu/paper-menu.html">
<link rel="import" href="/client/bower_components/paper-item/paper-item.html">
<link rel="import" href="/client/bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="/client/bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="/client/bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="/client/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="/client/bower_components/app-storage/app-localstorage/app-localstorage-document.html">
<link rel="import" href="/client/bower_components/paper-styles/shadow.html">

<link rel="import" href="/client/bower_components/app-layout/app-layout.html">

<!-- Router -->
<link rel="import" href="/client/bower_components/app-route/app-location.html">
<link rel="import" href="/client/bower_components/app-route/app-route.html">


<!-- Burst styles -->
<link rel="stylesheet" href="/client/fonts/roboto.css">
<link rel="stylesheet" href="/client/styles/main.css">

<!-- Custom elements -->
<link rel="import" href="/client/styles/app-theme.html">
<link rel="import" href="/client/elements/show-plugin.html">
<link rel="import" href="/client/elements/show-modal.html">
<link rel="import" href="/client/elements/login-page.html">

<dom-module id="main-app">
	<template>
        <custom-style>
            <style is="custom-style" include="burst-styles iron-flex iron-flex-alignment iron-positioning iron-flex-factors">
                paper-toolbar{
                    --paper-toolbar-title: {
                        lefarrayt:0;
                        margin-left:0;
                        font-size:17px;
                    }
                }

                app-drawer{
                    @apply --shadow-elevation-4dp;
                }
                
                app-header{
                    background: #fff;
                    @apply --shadow-elevation-2dp;
                }
                
                
                @media screen and (min-width: 640px) {
                    .show-only-mobile{
                        display: none;
                    }
                }
                .qora-title{
                    font-weight: 100;
                }
                .deny{
                    color:red;
                }
                .confirm{
                    color:green;
                }
                #transactionRequestDialog table{
                    text-align: left;
                }
                #transactionRequestDialog table tr:hover{
                    background: rgba(0,0,0,0.1)
                }
                .capitalize{
                    text-transform: capitalize;
                }
            </style>
        </custom-style>
        
        <div>
            <app-location route="{{route}}"></app-location>
            <app-route
                       route="{{route}}"
                       pattern="/qora/:currentPluginUrl"
                       data="{{routeData}}"
                       tail="{{subroute}}">
            </app-route>

            <!-- Store settings -->
            <app-localstorage-document key="qoraNode" data="{{qoraNode}}"></app-localstorage-document>
            <app-localstorage-document key="addressCount" data="{{addressCount}}"></app-localstorage-document>

            <!-- LOGIN PAGE -->
            <login-page loginpage="{{loginpage}}" node="{{qoraNode}}" passphrase="{{passphrase}}" pin="{{pin}}" address-count="{{addressCount}}"></login-page>


            <app-header-layout>

                <app-header slot="header">
                    <app-toolbar>
                        <paper-icon-button icon="menu" drawer-toggle on-click="_toggleDrawer" class="show-only-mobile"></paper-icon-button>
                        <div main-title><span class="qora-title">Qora | </span> {{activeUrl.title}}</div>
                        
                        <template is="dom-repeat" items="{{topMenuItems}}">
                            <paper-button style="font-size:16px; height:40px;" on-tap="_openTopMenuModal">{{item.text}}&nbsp;<iron-icon icon="{{item.icon}}"></iron-icon></paper-button>
                        </template>
                        
                        <paper-icon-button icon="settings"></paper-icon-button>
                        <paper-icon-button icon="power-settings-new" on-tap="_logout"></paper-icon-button>
                    </app-toolbar>
                </app-header>

                <app-drawer-layout>
                    
                    <!-- Make it nice n easy to make toasts -->
                    <!--<paper-toast id="toast0" text="This toast auto-closes after 3 seconds"></paper-toast>-->

                    <app-drawer swipe-open slot="drawer" id="appdrawer">
                        <app-header-layout has-scrolling-region>

                            <app-header fixed slot="header">
                                <app-toolbar>
                                    <div main-title>Qora</div>
                                </app-toolbar>
                            </app-header>
                            
                            <paper-listbox class="sideNavMenu" attr-for-selected="item-url" selected="{{route.path}}">
                                <template is="dom-repeat" items="{{urls}}">
                                    <template is="dom-if" if="menus.length > 0">
                                        <template is="dom-repeat" items="{{menus}}">
                                            <a href="{{_genIframeUrl(item.url)}}">{{item.title}}</a>
                                        </template>
                                    </template>

                                    <template is="dom-if" if="menus.length == 0">
                                        <paper-item item-url="{{_genIframeUrl(item.url)}}">
<!--
                                            <a is="pushstate-anchor" href="{{_genIframeUrl(item.url)}}">
                                            </a>
-->
                                            
                                            {{item.title}}
                                            <paper-ripple></paper-ripple>
                                        </paper-item>
                                    </template>
                                </template>
                            </paper-listbox>

                        </app-header-layout>
                    </app-drawer>


                    <!-- PLUGIN IFRAMEEEE -->
                    <!---------------------->
                    <show-plugin logged-in="{{loginpage.loggedin}}" current-plugin-frame="{{currentPluginFrame}}" route="{{route}}" data="{{routeData}}" subroute="{{subroute}}" url="{{activeUrl}}"></show-plugin>



                </app-drawer-layout>



            </app-header-layout>
            
            
            <!-- TOP MENU DIALOG -->
            <paper-dialog with-backdrop id="topMenuDialog">
                <show-modal modal-frame="{{modalFrame}}" item="{{selectedModal}}" frame-size="{{modalFrameSize}}"></show-modal>
            </paper-dialog>
            <!-- -->


            <!-- SEND MONEY CONFIRM DIALOG -->
            <!-- with-backdrop -->
            <paper-dialog id="sendMoneyConfirmDialog" modal>
                <h2>Send money request</h2>

                <table>
                    <tbody>
                        <tr><td>From</td><td>{{sendMoneyPrompt.address}}</td></tr>
                        <tr><td>Amount&nbsp;</td><td>{{sendMoneyPrompt.amount}} Qora</td></tr>
                        <tr><td>To</td><td>{{sendMoneyPrompt.recipient}}</td></tr>
                        <tr><td>Fee</td><td>{{sendMoneyPrompt.fee}}</td></tr>
                    </tbody>
                </table>


                <div class="buttons">
                    <paper-button autofocus dialog-dismiss on-tap="_rejectSendMoney" class="deny">Deny</paper-button>
                    <paper-button dialog-confirm on-tap="_acceptSendMoney" class="confirm">Confirm</paper-button>
                </div>
            </paper-dialog>
            
            <!-- CREATE TRANSACTION CONFIRM DIALOG --> 
            
            <paper-dialog id="transactionRequestDialog" modal>
                <h2>Transaction request</h2>
                
                <table>
                    <tbody>
                        <tr><th>Type</th><td>{{transactionRequest.typeText}}</td></tr>
                        <tr><th>From</th><td>{{transactionRequest.nonce}}</td></tr>
                        <template is="dom-repeat" items="{{objectKeys(transactionRequest.params)}}">
                            <tr><th class="capitalize">{{item.key}}</th><td>{{item.value}}</td></tr>
                        </template>
                    </tbody>
                </table>


                <div class="buttons">
                    <paper-button autofocus dialog-dismiss on-tap="rejectTransactionRequest" class="deny">Deny</paper-button>
                    <paper-button dialog-confirm on-tap="acceptTransactionRequest" class="confirm">Confirm</paper-button>
                </div>
            </paper-dialog>


            <!--<iframe id="plugin-js-loader" src="/client/plugin-js.html"></iframe>-->
        </div>
        
        
	</template>
    
<!--
    <script src="/client/js/wimp/wimp.js"></script>
    <script src="/client/js/wimp/wimp-parent.js"></script>
    <script>
        Wimp.proxy = true;
    </script>
-->
    
        
    <!-- Won't be needing these for Qora.... -->
    <!--<script src="/client/js/localSigningDeps.js"></script>
    <script src="/client/js/localSigning.js"></script>-->
    <!-- QORA *down arrow* -->
<!--
    <script src="/client/js/qora/deps/nacl-fast.js"></script>
    <script src="/client/js/qora/deps/Base58.js"></script>
    <script src="/client/js/qora/deps/sha256.js"></script>
    <script src="/client/js/qora/deps/ripemd160.js"></script>
    <script src="/client/js/qora/Utils.js"></script>
-->
<!--    <script src="/client/js/qora/deps/qora.js"></script>-->
    <!--<script src="/client/js/qora/deps/brainwallet.js"></script>-->

    <!-- Me Qora -->
<!--
    <script src="/client/js/qora/qoraHelper.js"></script>
    <script>
        // From qoraHelper.js....has API interactions
        Qora = new QoraCalls();
    </script>
-->
    
<!--    <script src="/client/js/qora/sendMoneyQora.js"></script>-->
    <!-- Wants jQuery...-->
    <!-- <script src="/client/js/qora-proto/common.js"></script> -->
    
<!--    <script src="/client/js/login.js"></script>-->
    <script src="/client/js/bundle.js"></script>
    
    <!-- Below will be possible when import/export feature detection is available, otherwise Wimp won't know how to export -->
<!--    <script nomodule src="/client/js/bundle.js"></script>-->
<!--    <script type="module" src="/client/js/app.js"></script>-->
    
    
    <!-- Old -->
	<!--
    <script src="/client/js/messageHandler.js"></script>
    <script src="/client/js/qora/qoraMessageHandler.js"></script>
    -->
<!--
    <script src="/client/js/communicator/CommunicatorBase.js"></script>
    <script src="/client/js/communicator/RequestHandler.js"></script>
    <script src="/client/js/communicator/QoraRequestHandler.js"></script>
    <script src="/client/js/communicator/BuiltInRequestHandler.js"></script>
    <script src="/client/js/communicator/StreamHandler.js"></script>
    <script src="/client/js/communicator/listener.js"></script>
-->
    
    <script>
        //const AllPlugins = new Wimp(App.currentPluginFrame)
    </script>
    
<!--    <script src="/client/js/pluginLoader.js"></script>-->
    
    <script>
        // console.log(App.loaderIframes);
        // console.log(App.currentPluginFrame.contentWindow);
    </script>
</dom-module>