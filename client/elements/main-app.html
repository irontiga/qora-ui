<link rel="import" href="/client/bower_components/polymer/polymer.html">
<link rel="import" href="/client/bower_components/polymer/lib/mixins/gesture-event-listeners.html">


<!-- Stupid polyfill -->
<link rel="import" href="/client/bower_components/web-animations-js/web-animations-next.min.js">
<link rel="import" href="/client/bower_components/neon-animation/web-animations.html">

<!-- POLYMER ELEMENTS -->
<link rel="import" href="/client/bower_components/paper-material/paper-material.html">
<link rel="import" href="/client/bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="/client/bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="/client/bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/client/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="/client/bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="/client/bower_components/paper-item/paper-item.html">
<link rel="import" href="/client/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/client/bower_components/iron-icons/av-icons.html">
<link rel="import" href="/client/bower_components/iron-icons/communication-icons.html">
<link rel="import" href="/client/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/client/bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="/client/bower_components/paper-menu/paper-menu.html">
<link rel="import" href="/client/bower_components/paper-item/paper-item.html">
<link rel="import" href="/client/bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="/client/bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="/client/bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="/client/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="/client/bower_components/app-storage/app-localstorage/app-localstorage-document.html">
<link rel="import" href="/client/bower_components/paper-styles/shadow.html">
<link rel="import" href="/client/bower_components/app-layout/app-layout.html">
<link rel="import" href="/client/bower_components/paper-toast/paper-toast.html">
<link rel="import" href="/client/bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="/client/bower_components/paper-fab/paper-fab.html">
<link rel="import" href="/client/bower_components/paper-input/paper-input.html">
<link rel="import" href="/client/bower_components/paper-input/paper-textarea.html">
<link rel="import" href="/client/bower_components/paper-swatch-picker/paper-swatch-picker.html">
<link rel="import" href="/client/bower_components/iron-label/iron-label.html">
<link rel="import" href="/client/bower_components/paper-button/paper-button.html">
<link rel="import" href="/client/bower_components/iron-pages/iron-pages.html">

<!-- GRID -->
<link rel="import" href="/client/bower_components/vaadin-material-theme/vaadin-grid.html">
<link rel="import" href="/client/bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="/client/bower_components/vaadin-grid/vaadin-grid-column-reordering-mixin.html">

<!-- Router -->
<link rel="import" href="/client/bower_components/app-route/app-location.html">
<link rel="import" href="/client/bower_components/app-route/app-route.html">


<!-- Burst styles -->
<link rel="stylesheet" href="/client/fonts/roboto.css">
<link rel="stylesheet" href="/client/styles/main.css">


<!-- Custom elements -->
<link rel="import" href="/client/styles/app-theme.html">
<link rel="import" href="/client/styles/app-styles.html">
<link rel="import" href="/client/elements/show-plugin.html">
<link rel="import" href="/client/elements/show-modal.html">
<link rel="import" href="/client/elements/login-container/login-container.html">
<link rel="import" href="/client/elements/settings-menu.html">

<dom-module id="main-app">
	<template>
        <custom-style>
            <style is="custom-style" include="app-theme iron-flex iron-flex-alignment iron-positioning iron-flex-factors app-styles">
                paper-toolbar{
                    --paper-toolbar-title: {
                        lefarrayt:0;
                        margin-left:0;
                        font-size:17px;
                    }
                }

                app-drawer{
                    @apply --shadow-elevation-4dp;
                }
                
                app-header{
                    background: #fff;
                    @apply --shadow-elevation-2dp;
                }
                
                
                @media screen and (min-width: 640px) {
                    .show-only-mobile{
                        display: none;
                    }
                }
                .qora-title{
                    font-weight: 100;
                }
                .deny{
                    color:red;
                }
                .confirm{
                    color:green;
                }
                #transactionRequestDialog table{
                    text-align: left;
                }
                #transactionRequestDialog table tr:hover{
                    background: rgba(0,0,0,0.1)
                }
                .capitalize{
                    text-transform: capitalize;
                }
                i.dot::before{
                    content: "\25CF";
                    font-size: 20px;
                    padding-right: 8px;
                }

                paper-listbox.sideNavMenu paper-item {
                    font-size: 14px;
                    font-weight: 400;
                    text-transform: uppercase;
                }
                paper-listbox.sideNavMenu paper-item:focus::before {
                    background: inherit;
                }
                paper-listbox.sideNavMenu paper-item.iron-selected{
/*                    color: var(--active-menu-item-color);*/
                    font-weight: 700;
                }
            </style>
        </custom-style>
        
        <div>
            <app-location route="{{route}}"></app-location>
            <app-location route="{{hashRoute}}" use-hash-as-path></app-location>
            <app-route
                       route="{{route}}"
                       pattern="/qora/:currentPluginUrl"
                       data="{{routeData}}"
                       tail="{{subroute}}">
            </app-route>
            <app-route
                       route="{{hashRoute}}"
                       pattern="/:hash"
                       data="{{hash}}"
                       tail="{{subhash}}">
            </app-route>



            <!-- LOGIN PAGE -->
<!--            <login-page loginpage="{{loginpage}}"passphrase="{{passphrase}}" pin="{{pin}}" address-count="{{addressCount}}"  open-settings='{{getOpenSettings()}}'></login-page>-->
            <login-container id="login-container" class="fade-hide" hidden$="{{loggedIn}}" logged-in="{{loggedIn}}" wallet="{{wallet}}" address-count="{{addressCount}}" addresses="{{addresses}}" address-colors="{{addressColors}}" open-settings='{{getOpenSettings()}}'></login-container>

            
            <app-drawer-layout>
                <app-drawer swipe-open slot="drawer" id="appdrawer">
                    <app-header-layout has-scrolling-region>
                        
                        
                        <div id="accountDrawer" style$="background-color: {{selectedAddress.color}}">
                            <iron-icon style$="color: {{textColor(selectedAddress.textColor)}};height:60px; width:60px; padding:12px;" icon="account-circle"></iron-icon>
                            <paper-menu-button horizontal-align="left" id="accountMenu" style="padding:0; max-width:100%;">
                                <div slot="dropdown-trigger" style="position:relative">
                                    <!--                                <paper-icon-button noink icon="account-circle"></paper-icon-button>-->
                                    <div style="max-width:auto !important; padding:8px; text-overflow: ellipsis; overflow:hidden; font-size:16px; white-space: nowrap; color: {{textColor(selectedAddress.textColor)}};">
                                        <iron-icon icon="icons:arrow-drop-down"></iron-icon>
                                        {{selectedAddress.address}}
                                    </div>
                                    <paper-ripple></paper-ripple>
                                </div>
                                <paper-tooltip position="bottom">Account</paper-tooltip>



                                <div slot="dropdown-content">
                                    <paper-listbox slot="dropdown-content" selected="{{selectedAddress}}" attr-for-selected="address">
                                        <template is="dom-repeat" items="{{addresses}}">
                                            <paper-item address="{{item}}">
                                                <i class="dot" style$="color: {{item.color}}"></i>{{item.address}}
                                                <paper-ripple></paper-ripple>
                                            </paper-item>
                                        </template>
                                    </paper-listbox>
                                </div>
                            </paper-menu-button>
                        </div>
                        
                        

                        <paper-listbox class="sideNavMenu" attr-for-selected="item-url" selected="{{route.path}}">
                            <template is="dom-repeat" items="{{urls}}">
                                <template is="dom-if" if="menus.length > 0">
                                    <template is="dom-repeat" items="{{menus}}">
                                        <a href="{{_genIframeUrl(item.url)}}">{{item.title}}</a>
                                    </template>
                                </template>

                                <template is="dom-if" if="menus.length == 0">
                                    <paper-item item-url="{{_genIframeUrl(item.url)}}" style="width:auto;">
                                        <!--
<a is="pushstate-anchor" href="{{_genIframeUrl(item.url)}}">
</a>
-->
                                        <iron-icon style="opacity:1" icon="{{item.icon}}"></iron-icon>
                                        {{item.title}}
                                        <paper-ripple></paper-ripple>
                                    </paper-item>
                                </template>
                            </template>
                            
                        </paper-listbox>

                    </app-header-layout>
                </app-drawer>

                <app-header-layout>

                    <app-header slot="header">
                        <app-toolbar>
                            
                            <paper-icon-button icon="menu" drawer-toggle onclick="_toggleDrawer" class="show-only-mobile"></paper-icon-button>
                            
                            <div main-title><span class="qora-title">Qora | </span> {{activeUrl.title}} <small><i>{{route.path}}#{{hashRoute.path}}</i></small></div>

                            <template is="dom-repeat" items="{{topMenuItems}}">
                                <paper-button style="font-size:16px; height:40px;" on-tap="_openTopMenuModal">{{item.text}}&nbsp;<iron-icon icon="{{item.icon}}"></iron-icon></paper-button>
                            </template>



                            

                            <!--
<div style="display:inline">
<paper-icon-button icon="add" id="addAccountButton"></paper-icon-button>
<paper-tooltip position="top">Add an account</paper-tooltip>
</div>
<div style="display:inline">
<paper-icon-button icon="settings"></paper-icon-button>
<paper-tooltip position="top">Settings</paper-tooltip>
</div>
-->
                            <div style="display:inline">
                                <paper-icon-button icon="icons:settings" on-tap="openSettings"></paper-icon-button>
                                <paper-tooltip position="top">Logout</paper-tooltip>
                                <paper-icon-button icon="power-settings-new" on-tap="logOut"></paper-icon-button>
                            </div>
                        </app-toolbar>
                    </app-header>

                    <show-plugin logged-in="{{loggedIn}}" current-plugin-frame="{{currentPluginFrame}}" route="{{route}}" data="{{routeData}}" subroute="{{subroute}}" url="{{activeUrl}}"></show-plugin>

                </app-header-layout>
            </app-drawer-layout>
            
            
            <!-- TOP MENU DIALOG -->
            <paper-dialog with-backdrop id="topMenuDialog">
                <show-modal modal-frame="{{modalFrame}}" item="{{selectedModal}}" frame-size="{{modalFrameSize}}"></show-modal>
            </paper-dialog>
            <!-- -->
            
            <!-- SETTINGS -->
            <paper-dialog with-backdrop id="settingsDialog">
                <settings-menu style="width: 400px; height:400px; max-width: 100%; max-height: 100%;" qora-node="{{qoraNode}}" address-colors="{{addressColors}}" address-count="{{addressCount}}"></settings-menu>
            </paper-dialog>
            <!-- -->
            
            <!-- CREATE TRANSACTION CONFIRM DIALOG --> 
            
            <paper-dialog id="transactionRequestDialog" modal>
                <h2>Transaction request</h2>
                
                <table>
                    <tbody>
                        <tr><th>Type</th><td>{{transactionRequest.typeText}}</td></tr>
                        <tr><th>From</th><td>{{transactionRequest.nonce}}</td></tr>
                        <template is="dom-repeat" items="{{objectKeys(transactionRequest.params)}}">
                            <tr><th class="capitalize">{{item.key}}</th><td>{{item.value}}</td></tr>
                        </template>
                    </tbody>
                </table>


                <div class="buttons">
                    <paper-button autofocus dialog-dismiss on-tap="rejectTransactionRequest" class="deny">Deny</paper-button>
                    <paper-button dialog-confirm on-tap="acceptTransactionRequest" class="confirm">Confirm</paper-button>
                </div>
            </paper-dialog>
            
            <paper-toast id="toastElement" duration="3" text="{{toast.text}}">
                <paper-button onclick="toast.res" class="yellow-button">Close now!</paper-button>
            </paper-toast>


            <!--<iframe id="plugin-js-loader" src="/client/plugin-js.html"></iframe>-->
        </div>
        
        
	</template>
    
<!--
    <script src="/client/js/wimp/wimp.js"></script>
    <script src="/client/js/wimp/wimp-parent.js"></script>
    <script>
        Wimp.proxy = true;
    </script>
-->
    
        
    <!-- Won't be needing these for Qora.... -->
    <!--<script src="/client/js/localSigningDeps.js"></script>
    <script src="/client/js/localSigning.js"></script>-->
    <!-- QORA *down arrow* -->
<!--
    <script src="/client/js/qora/deps/nacl-fast.js"></script>
    <script src="/client/js/qora/deps/Base58.js"></script>
    <script src="/client/js/qora/deps/sha256.js"></script>
    <script src="/client/js/qora/deps/ripemd160.js"></script>
    <script src="/client/js/qora/Utils.js"></script>
-->
<!--    <script src="/client/js/qora/deps/qora.js"></script>-->
    <!--<script src="/client/js/qora/deps/brainwallet.js"></script>-->

    <!-- Me Qora -->
<!--
    <script src="/client/js/qora/qoraHelper.js"></script>
    <script>
        // From qoraHelper.js....has API interactions
        Qora = new QoraCalls();
    </script>
-->
    
<!--    <script src="/client/js/qora/sendMoneyQora.js"></script>-->
    <!-- Wants jQuery...-->
    <!-- <script src="/client/js/qora-proto/common.js"></script> -->
    
<!--    <script src="/client/js/login.js"></script>-->
    <script src="/client/js/bundle.js"></script>
    
    <!-- Below will be possible when import/export feature detection is available, otherwise Wimp won't know how to export -->
<!--    <script nomodule src="/client/js/bundle.js"></script>-->
<!--    <script type="module" src="/client/js/app.js"></script>-->
    
    
    <!-- Old -->
	<!--
    <script src="/client/js/messageHandler.js"></script>
    <script src="/client/js/qora/qoraMessageHandler.js"></script>
    -->
<!--
    <script src="/client/js/communicator/CommunicatorBase.js"></script>
    <script src="/client/js/communicator/RequestHandler.js"></script>
    <script src="/client/js/communicator/QoraRequestHandler.js"></script>
    <script src="/client/js/communicator/BuiltInRequestHandler.js"></script>
    <script src="/client/js/communicator/StreamHandler.js"></script>
    <script src="/client/js/communicator/listener.js"></script>
-->
    
    <script>
        //const AllPlugins = new Wimp(App.currentPluginFrame)
    </script>
    
<!--    <script src="/client/js/pluginLoader.js"></script>-->
    
    <script>
        // console.log(App.loaderIframes);
        // console.log(App.currentPluginFrame.contentWindow);
    </script>
</dom-module>